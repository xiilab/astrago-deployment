## AstraGo Deployment 개선 로드맵 문서 (2025)

### 문서 목적
현행 AstraGo 배포 체계를 단순화·표준화하고, 다양한 고객 환경(폐쇄망/온라인/방화벽)에서도 재현 가능하며 안정적인 설치/운영이 가능하도록 리팩토링 로드맵과 실행 이슈를 정의한다.

### 범위
- 리포지토리/Helmfile/Values 구조 리팩토링
- Kubespray 및 Airgap 업데이트 전략 수립/자동화
- 설치 사전 검증 모듈(Go) 개발
- 리셀러 친화 Installer(TUI/CLI) 제작
- 고객-당사 정보 교환 체계 표준화
- astrago-operator(가칭) 설계·MVP 구현·마이그레이션 전략

### 메타데이터 제안
- 팀: Back-end Team
- 라벨: 🚀 Feature, 🔄 Refactor
- 상위 에픽 추정치: 0 point (하위 이슈 합산)

---

### [Epic] AstraGo Deployment 개선 (0 point)
플랫폼 설치·업데이트·운영 전반을 단순/자동화하는 상위 목표.

---

### [A1] Helmfile/Values 구조 리팩토링(공통/환경 분리, 업그레이드 용이화)

## 🎯 이슈 요약
Helmfile/values 구조를 공통과 환경별로 정리해 신규 차트/버전 업데이트를 단순화

## 📋 상세 설명
### 현재 상황
- 공통/환경 값이 혼재되고 중복 정의 다수
- 신규 Helm 차트 업데이트 시 충돌/누락 위험

### 기대 결과
- 공통은 `values.yaml.gotmpl`, 환경 차이는 `environments/<env>/values.yaml`로 일원화
- 신규 차트 추가/업데이트 시 변경 범위 최소화

## 🔧 작업 범위
### 주요 작업
- [ ] 공통/환경별 값 재배치 및 중복 제거
- [ ] `helmfile.yaml` 릴리즈 단위/네이밍 컨벤션 정립
- [ ] 차트 버전 업그레이드 가이드/체크리스트 문서화

### 기술적 요구사항
- Helmfile 템플릿(`gotmpl`), 릴리즈/값 상속 패턴

## 📎 참고자료
- `applications/*/values.yaml.gotmpl`, `environments/*/values.yaml`, `helmfile.yaml`

## ⚠️ 주의사항
- 환경별 오버라이드 충돌 방지, 기본값 안전성 확보

우선순위: High  
담당자: TBD  
시작일: YYYY-MM-DD  
완료 예정일: YYYY-MM-DD  
예상 소요 시간: 2 point

---

### [A2] Kubespray 및 Airgap 업데이트 전략 수립/자동화

## 🎯 이슈 요약
`kubespray`/`airgap` 업데이트를 표준화하고 절차/스크립트를 자동화

## 📋 상세 설명
### 현재 상황
- 쿠버네티스/이미지 업데이트가 수동 중심, 리스크 큼

### 기대 결과
- 버전 매트릭스/변경 로그 체계화
- 사전 검증 및 롤백 절차 자동화

## 🔧 작업 범위
### 주요 작업
- [ ] 버전/이미지 소스 테이블 관리 자동화 스크립트
- [ ] 테스트 클러스터 사전 검증 파이프라인(GitHub Actions)
- [ ] 롤백/리커버리 가이드 정립(스냅샷/백업)

### 기술적 요구사항
- Ansible/Kubespray, Airgap 이미지 리스트/미러링 자동화

## 📎 참고자료
- `airgap/imagelists/`, `airgap/kubespray-offline/`, `kubespray/`

## ⚠️ 주의사항
- 폐쇄망에서도 재현 가능한 절차 확보

우선순위: High  
담당자: TBD  
시작일: YYYY-MM-DD  
완료 예정일: YYYY-MM-DD  
예상 소요 시간: 3 point

---

### [A3] 설치 사전 검증 모듈(Go) 설계/구현

## 🎯 이슈 요약
네트워크/포트/SSH/자원/OS 요구사항을 자동 점검하는 프리플라이트 도구 개발

## 📋 상세 설명
### 현재 상황
- 환경별 제약을 수동 확인 → 설치 실패/재시도 증가

### 기대 결과
- 모든 환경(온라인/폐쇄망)에서 바이너리 1개로 빠른 검증
- 결과 리포트/권고안 자동 생성(JSON/YAML/TTY)

## 🔧 작업 범위
### 주요 작업
- [ ] 점검 항목 정의(포트/방화벽/SSH/디스크/커널/프록시/레지스트리 접근)
- [ ] Go 모듈 구현, 병렬 체크/타임아웃, 결과 리포트 출력
- [ ] CI 연동 및 Installer/Operator 통합

### 기술적 요구사항
- Go, rootless/privileged 모드 지원, 네트워크/파일시스템 검사

## 📎 참고자료
- `scripts/setup-k8s-firewall.sh`, `docs/AstraGo-Infra.md`

## ⚠️ 주의사항
- 방화벽/프록시 존재 시 대체 경로/권고안 제시

우선순위: High  
담당자: TBD  
시작일: YYYY-MM-DD  
완료 예정일: YYYY-MM-DD  
예상 소요 시간: 3 point

---

### [A4] Installer TUI/CLI 제작(리셀러 친화 설치 플로우)

## 🎯 이슈 요약
터미널 기반 TUI/CLI 설치기 제공으로 리셀러 셀프-가이드 설치 지원

## 📋 상세 설명
### 현재 상황
- 스크립트 중심 설치, 옵션/순서 혼동 가능성

### 기대 결과
- 대화형 스텝, 프로파일(온라인/폐쇄망/프록시), 로그/리포트 자동 수집

## 🔧 작업 범위
### 주요 작업
- [ ] TUI(예: Bubble Tea)/CLI 옵션 설계 및 도움말
- [ ] 환경 프로파일 선택 UX 및 기본값 프리셋
- [ ] 실패 케이스 롤백/재시도 시나리오

### 기술적 요구사항
- Go TUI/CLI, 크로스 플랫폼 빌드, 컬러 로그/프로그레스바

## 📎 참고자료
- `deploy_astrago.sh`, `astrago_gui_installer.py`

## ⚠️ 주의사항
- 비대화형 모드(CI/자동화) 지원, 로깅 표준화

우선순위: Normal  
담당자: TBD  
시작일: YYYY-MM-DD  
완료 예정일: YYYY-MM-DD  
예상 소요 시간: 2 point

---

### [A5] 고객-당사 정보 교환 체크리스트/양식 표준화

## 🎯 이슈 요약
사전 정보 수집 양식/체크리스트 표준화로 커뮤니케이션 비용 절감

## 📋 상세 설명
### 현재 상황
- 설치 전 요구정보 항목/형식이 일관되지 않음

### 기대 결과
- 템플릿(네트워크/계정/보안/레지스트리/리소스) 및 샘플 제공
- 프리플라이트 결과와 항목 매핑

## 🔧 작업 범위
### 주요 작업
- [ ] 문서/스프레드시트 템플릿 제작(다국어 선택)
- [ ] 민감정보 분리/마스킹 가이드

### 기술적 요구사항
- 문서화 체계, 안전한 전달 경로 정의

## 📎 참고자료
- `docs/`, 기존 납품 산출물

## ⚠️ 주의사항
- PII/보안 항목 처리 주의

우선순위: Normal  
담당자: TBD  
시작일: YYYY-MM-DD  
완료 예정일: YYYY-MM-DD  
예상 소요 시간: 1 point

---

### [A6] astrago-operator 설계(아키텍처/CRD/리컨실 전략)

## 🎯 이슈 요약
Operator 기반 자동 설치/운영을 위한 설계 산출물 완성

## 📋 상세 설명
### 현재 상황
- Helmfile 스크립트 중심 → 상태 관리/자가 치유 한계

### 기대 결과
- CRD(예: `AstragoPlatform`, `ComponentSet`) 정의
- 상태/이벤트 모델, 에러/재시도/백오프 정책 확정

## 🔧 작업 범위
### 주요 작업
- [ ] 설계 문서(다이어그램/시퀀스/상태기계)
- [ ] 샘플 CRD 스펙 초안 및 밸리데이션

### 기술적 요구사항
- Kubebuilder, Controller Runtime, Finalizer/OwnerRef, 조건형 상태

## 📎 참고자료
- `applications/*`, 운영 구성값, 설치 흐름 문서

## ⚠️ 주의사항
- 멱등성/재시도/부분 실패 복구 전략 명확화

우선순위: High  
담당자: TBD  
시작일: YYYY-MM-DD  
완료 예정일: YYYY-MM-DD  
예상 소요 시간: 2 point

---

### [A7] astrago-operator MVP 구현(핵심 컴포넌트 설치)

## 🎯 이슈 요약
핵심 릴리즈(ingress, registry, keycloak, prometheus 등) 설치까지 자동화

## 📋 상세 설명
### 현재 상황
- 수동/스크립트 설치 혼재

### 기대 결과
- CR 적용 시 설치/상태 동기화/오류 복구

## 🔧 작업 범위
### 주요 작업
- [ ] Reconcile 루프 구현, Helm 라이브러리 연동
- [ ] 상태 조건, 이벤트/로그 구조화

### 기술적 요구사항
- Helm Operator 패턴, K8s RBAC/권한

## 📎 참고자료
- `applications/*/helmfile.yaml`

## ⚠️ 주의사항
- 재진입성 보장, 실패 단계 선택적 재처리

우선순위: High  
담당자: TBD  
시작일: YYYY-MM-DD  
완료 예정일: YYYY-MM-DD  
예상 소요 시간: 3 point

---

### [A8] Helmfile → Operator 마이그레이션 경로/롤백 전략

## 🎯 이슈 요약
기존 설치 환경을 Operator로 전환하는 절차와 안전한 롤백 전략 수립

## 📋 상세 설명
### 현재 상황
- 기존 환경 유지 중단 없이 전환 필요

### 기대 결과
- 점진 전환(카나리/네임스페이스 단위) 가이드
- 실패 시 Helmfile 기반 복귀 절차 문서화

## 🔧 작업 범위
### 주요 작업
- [ ] 전환/검증 체크리스트
- [ ] 데이터/시크릿/상태 동기화 절차

### 기술적 요구사항
- CRD 버전 관리, OwnerRef 인수인계

## 📎 참고자료
- 기존 배포 스크립트/문서

## ⚠️ 주의사항
- 다운타임 최소화, 백업/스냅샷 전략

우선순위: High  
담당자: TBD  
시작일: YYYY-MM-DD  
완료 예정일: YYYY-MM-DD  
예상 소요 시간: 2 point

---

### [A9] Kubernetes 배포 스택 전환 검토(Rancher RKE2 vs k0s)

## 🎯 이슈 요약
Kubespray(Ansible) 기반 한계를 고려하여 RKE2 또는 k0s로 전환 검토 및 선택(폐쇄망 적합성 포함)

## 📋 상세 설명
### 현재 상황
- Kubespray는 Ansible 기반으로 설치/확장/축소에 시간이 오래 걸리고 운영 난이도가 높음

### 기대 결과
- 설치가 간편·신속하고 노드 증설/교체가 쉬우며 폐쇄망을 안정적으로 지원하는 배포 스택 채택

## 🔧 작업 범위
### 주요 작업
- [ ] 기능/운영성/보안/비용 관점의 평가 지표 수립 및 비교표 작성
- [ ] 온라인/폐쇄망(air-gapped) 환경 PoC: 설치 시간, 확장/축소 난이도, 업그레이드/롤백
- [ ] 이미지 미러/레지스트리, 프록시/인증, SELinux/systemd 호환성 검증
- [ ] 전환 전략 초안(마이그레이션/데이터 보존/다운타임 최소화)

### 기술적 요구사항
- RKE2, k0s, air-gapped 레지스트리/프록시, OS 호환성(RHEL/Ubuntu 등)

## 📎 참고자료
- `airgap/`, `kubespray/`, 고객 환경 제약 정리 문서

## ⚠️ 주의사항
- 장기 업그레이드 스트림(LTS) 및 CVE 대응 체계, 장애 시 롤백 경로 명확화

우선순위: High  
담당자: TBD  
시작일: YYYY-MM-DD  
완료 예정일: YYYY-MM-DD  
예상 소요 시간: 3 point

---

### [A10] Kubernetes 및 AstraGo 백업/이중화 전략 수립

## 🎯 이슈 요약
클러스터(etcd)와 AstraGo 데이터베이스의 백업/복구/이중화 전략 수립 및 표준 제공

## 📋 상세 설명
### 현재 상황
- 백업/DR/이중화 가이드가 부족하여 장애 복구와 고객 요구 대응에 리스크 존재

### 기대 결과
- 정기 백업(스냅샷/증분), 암호화/보관 정책, 복구 리허설 절차, DB 이중화(HA) 아키텍처 제공

## 🔧 작업 범위
### 주요 작업
- [ ] etcd 백업/복구 표준 작업(스케줄, 보관/암호화 정책, 복구 리허설 체크리스트)
- [ ] AstraGo DB(예: Postgres) 이중화(Primary/Standby) 및 백업 전략 설계
- [ ] S3/MinIO 등 오브젝트 스토리지 연동, 오프사이트 보관/보안 키 관리(KMS)
- [ ] 복구 성공 기준/리드타임(RTO/RPO) 정의와 검증 리포트 양식

### 기술적 요구사항
- etcd 스냅샷/restore, Wal-G/pgBackRest 등 DB 백업 도구, 암호화/버전 관리

## 📎 참고자료
- 운영 Runbook, 고객 보안/보관 요구사항, `docs/AstraGo-Infra.md`

## ⚠️ 주의사항
- 복구 리허설 정례화, 랜섬웨어/오염된 백업 방지(버전·불변성)

우선순위: High  
담당자: TBD  
시작일: YYYY-MM-DD  
완료 예정일: YYYY-MM-DD  
예상 소요 시간: 3 point

---

### 마일스톤(제안)
- M1: 구조 리팩토링/배포 스택 선택/업데이트 전략(A1, A2, A9)
- M2: 프리플라이트/Installer 제공/정보 체계(A3, A4, A5)
- M3: Operator 설계·MVP·전환/백업·이중화(A6, A7, A8, A10)

---

