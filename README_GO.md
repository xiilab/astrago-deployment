# Astrago Chart Sync Tool (Go Version)

Helm ì°¨íŠ¸ ë™ê¸°í™” ë„êµ¬ì˜ Go ë²„ì „ì…ë‹ˆë‹¤. ì˜¤í”„ë¼ì¸/ì—ì–´ê°­ í™˜ê²½ì„ ìœ„í•´ ì™¸ë¶€ Helm ì°¨íŠ¸ë¥¼ ë¡œì»¬ë¡œ ë‹¤ìš´ë¡œë“œí•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.

## íŠ¹ì§•

- ğŸš€ **ê³ ì„±ëŠ¥**: Goë¡œ ì‘ì„±ë˜ì–´ ë¹ ë¥¸ ì‹¤í–‰ ì†ë„
- ğŸ“¦ **ë„¤ì´í‹°ë¸Œ Helm í†µí•©**: Helm ë¼ì´ë¸ŒëŸ¬ë¦¬ ì§ì ‘ ì‚¬ìš©
- ğŸ”’ **ì²´í¬ì„¬ ê²€ì¦**: ì°¨íŠ¸ ë¬´ê²°ì„± ìë™ ê²€ì¦
- ğŸ”§ **Chart.lock ìë™ ìˆ˜ì •**: ì˜¤í”„ë¼ì¸ í™˜ê²½ì„ ìœ„í•œ ìë™ ì„¤ì •
- ğŸ“‹ **ë²„ì „ ê´€ë¦¬**: versions.lock íŒŒì¼ë¡œ ì²´ê³„ì  ê´€ë¦¬

## ì„¤ì¹˜

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­
- Go 1.21 ì´ìƒ
- Helm 3.x

### ë¹Œë“œ
```bash
# ì˜ì¡´ì„± ì„¤ì¹˜
make deps

# ë°”ì´ë„ˆë¦¬ ë¹Œë“œ
make build

# ì‹œìŠ¤í…œì— ì„¤ì¹˜ (ì˜µì…˜)
make install
```

## ì‚¬ìš©ë²•

### ì°¨íŠ¸ ë‹¤ìš´ë¡œë“œ
```bash
./chart-sync download
# ë˜ëŠ”
make run-download
```

### ì²´í¬ì„¬ ê²€ì¦
```bash
./chart-sync validate
# ë˜ëŠ”
make run-validate
```

### ë‹¤ìš´ë¡œë“œëœ ì°¨íŠ¸ ëª©ë¡ í™•ì¸
```bash
./chart-sync list
# ë˜ëŠ”
make run-list
```

### Chart.lock ìˆ˜ì •
```bash
./chart-sync fix-locks
# ë˜ëŠ”
make run-fix-locks
```

### ì°¨íŠ¸ ì •ë¦¬
```bash
./chart-sync clean
# ë˜ëŠ”
make run-clean
```

## ì„¤ì •

### charts.json
ì°¨íŠ¸ ì •ë³´ë¥¼ ì •ì˜í•˜ëŠ” ì„¤ì • íŒŒì¼:

```json
{
  "repositories": {
    "bitnami": "https://charts.bitnami.com/bitnami",
    "prometheus-community": "https://prometheus-community.github.io/helm-charts"
  },
  "charts": {
    "keycloak": {
      "repository": "bitnami",
      "version": "21.4.4"
    },
    "kube-prometheus-stack": {
      "repository": "prometheus-community", 
      "version": "61.9.0"
    }
  }
}
```

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
.
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ chart-sync/
â”‚       â””â”€â”€ main.go          # ë©”ì¸ ì§„ì…ì 
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ cmd/                 # CLI ëª…ë ¹ì–´
â”‚   â”‚   â”œâ”€â”€ download.go
â”‚   â”‚   â”œâ”€â”€ validate.go
â”‚   â”‚   â”œâ”€â”€ list.go
â”‚   â”‚   â”œâ”€â”€ clean.go
â”‚   â”‚   â””â”€â”€ fixlocks.go
â”‚   â”œâ”€â”€ config/              # ì„¤ì • ê´€ë¦¬
â”‚   â”‚   â””â”€â”€ charts.go
â”‚   â”œâ”€â”€ helm/                # Helm í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â””â”€â”€ client.go
â”‚   â”œâ”€â”€ chart/               # ì°¨íŠ¸ ìˆ˜ì •
â”‚   â”‚   â””â”€â”€ modifier.go
â”‚   â””â”€â”€ lock/                # versions.lock ê´€ë¦¬
â”‚       â””â”€â”€ manager.go
â”œâ”€â”€ go.mod                   # Go ëª¨ë“ˆ ì •ì˜
â”œâ”€â”€ Makefile                 # ë¹Œë“œ ìë™í™”
â””â”€â”€ charts.json              # ì°¨íŠ¸ ì„¤ì •
```

## ì£¼ìš” ê¸°ëŠ¥

### 1. ì°¨íŠ¸ ë‹¤ìš´ë¡œë“œ
- charts.jsonì— ì •ì˜ëœ ëª¨ë“  ì°¨íŠ¸ ë‹¤ìš´ë¡œë“œ
- ìë™ìœ¼ë¡œ ì˜ì¡´ì„± í•´ê²°
- ë²„ì „ë³„ ë””ë ‰í† ë¦¬ ìƒì„±

### 2. ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì§€ì›
- Chart.yamlì˜ repositoryë¥¼ `file://charts/<name>`ìœ¼ë¡œ ìë™ ë³€ê²½
- Chart.lock ì¬ìƒì„±ìœ¼ë¡œ ë¡œì»¬ ì°¨íŠ¸ ì°¸ì¡°

### 3. ë¬´ê²°ì„± ê²€ì¦
- SHA256 ì²´í¬ì„¬ìœ¼ë¡œ ì°¨íŠ¸ ë¬´ê²°ì„± í™•ì¸
- versions.lock íŒŒì¼ì— ì²´í¬ì„¬ ì €ì¥

## ì¥ì  (vs Bash ìŠ¤í¬ë¦½íŠ¸)

1. **ì„±ëŠ¥**: ì»´íŒŒì¼ëœ ë°”ì´ë„ˆë¦¬ë¡œ ë¹ ë¥¸ ì‹¤í–‰
2. **ì•ˆì •ì„±**: íƒ€ì… ì•ˆì •ì„±ê³¼ ì—ëŸ¬ ì²˜ë¦¬
3. **ë„¤ì´í‹°ë¸Œ í†µí•©**: Helm Go ë¼ì´ë¸ŒëŸ¬ë¦¬ ì§ì ‘ ì‚¬ìš©
4. **ìœ ì§€ë³´ìˆ˜**: êµ¬ì¡°í™”ëœ ì½”ë“œë¡œ í™•ì¥ ìš©ì´
5. **í…ŒìŠ¤íŠ¸**: Go í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ í™œìš© ê°€ëŠ¥

## ê°œë°œ

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
make test
```

### ìƒˆ ëª…ë ¹ì–´ ì¶”ê°€
1. `internal/cmd/` ë””ë ‰í† ë¦¬ì— ìƒˆ íŒŒì¼ ìƒì„±
2. `cobra.Command` êµ¬ì¡°ì²´ êµ¬í˜„
3. `cmd/chart-sync/main.go`ì— ëª…ë ¹ì–´ ë“±ë¡

## ë¼ì´ì„ ìŠ¤

Astrago í”„ë¡œì íŠ¸ì˜ ì¼ë¶€ë¡œ ì œê³µë©ë‹ˆë‹¤.